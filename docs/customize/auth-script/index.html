<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Custom Script How-To - Gluu Docs</title>
  

  <link rel="shortcut icon" href="../../img/gluu_favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Gluu Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
			
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Introduction</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../introduction/">Summary</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../introduction/history/">History</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../introduction/design/">Design Goals</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../introduction/architecture/">Gluu Server Architecture</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Install Gluu CE</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deployment/">Preparing VM</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deployment/ubuntu/">Ubuntu 14.04</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deployment/ubuntu-xenial/">Ubuntu 16.04</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deployment/centos/">CentOS 6.x</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deployment/centos7/">CentOS 7.2</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deployment/rhel/">RHEL 6.x</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deployment/rhel7/">RHEL 7</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deployment/debian/">Debian</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deployment/setup_py/">Setup Script Options</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deployment/azure/">Microsoft Azure Guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deployment/linode/">Linode VM Guide</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Upgrade/Update Gluu CE</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deployment/upgrading/">Upgrade from 2.4.x</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deployment/updating/">Update Gluu CE 2.4.4</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Cluster Configuration</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../cluster/csync-installation/">Requirements: csync2 Installation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../cluster/">Clustering with CE</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Gluu Server GUI</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../oxtrust/configuration/">Configuration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../gluu-defaults/oxtrust-properties/">OxTrust JSON Configuration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../gluu-defaults/oxauth-properties/">OxAuth JSON Configuration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/outbound-saml/">SAML</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/openid-connect/">OpenID Connect</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/uma/">UMA</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../oxtrust/users/">Users</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../oxtrust/personal/">Personal</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>User Managment</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../cache-refresh/">Sync LDAP/AD</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../user-management/xlsfile/">Import XLS File</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../cache-refresh/register/">Register Users</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../cache-refresh/reset-password/">Reset User Password</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../user-management/scim/">SCIM 2.0 Add/Delete User</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Authentication</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../multi-factor/intro/">Intro</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../multi-factor/duo/">DUO</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../multi-factor/u2f/">U2F</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../multi-factor/oxpush2/">oxPush2</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../multi-factor/wikid/">Wikid</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../multi-factor/cert/">Certificate</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../social-login-google/">Google Authentication</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>FAQ</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../faq/general/">General</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../faq/troubleshooting/">Troubleshooting</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>How To</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../how-to/automate-schema/">Automate Custom Schema</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/scimuma-howto/">Protect SCIM endpoints with UMA</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../user-management/lock-user/">Lock User on Failed Attempt</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../how-to/uma-demo/">Configure UMA</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../how-to/update-certificate/">Update Gluu Server Certificates</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../how-to/saml_proxy_end_to_end/">Inbound SAML End to End Testing</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Customize Gluu Server</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../design/">Design Customization</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../script/">Behaviour Customization</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Custom Script How-To</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#writing-a-custom-authentication-script">Writing a Custom Authentication Script</a></li>
                
                    <li><a class="toctree-l4" href="#custom-script-location">Custom Script Location</a></li>
                
                    <li><a class="toctree-l4" href="#suggested-development-environment">Suggested Development Environment</a></li>
                
                    <li><a class="toctree-l4" href="#samples-and-documentation">Samples and Documentation</a></li>
                
                    <li><a class="toctree-l4" href="#implement-methods">Implement methods</a></li>
                
                    <li><a class="toctree-l4" href="#custom-properties">Custom Properties</a></li>
                
                    <li><a class="toctree-l4" href="#returning-a-message-to-the-user">Returning a message to the user</a></li>
                
                    <li><a class="toctree-l4" href="#adding-libraries">Adding Libraries</a></li>
                
                    <li><a class="toctree-l4" href="#testing">Testing</a></li>
                
            
                <li class="toctree-l3"><a href="#reverting-authentication-method">Reverting Authentication Method</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../attributes/">Custom Attributes</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Supported Protocols</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/outbound-saml/">Outbound SAML</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/inbound-saml/">Inbound SAML</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/openid-connect/">OpenID Connect</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/uma/">UMA</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/oauth2grants/">OAuth2</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/scim-1.1/">SCIM 1.1</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/scim-2.0/">SCIM 2.0</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>SP / RP Integration Modules</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/oxd/">oxd OAuth2 Client Software </a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/ubuntu-installation/">OpenID Connect RP in Ubuntu</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/centos-installation/">OpenID Connect RP in CentOS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/oxray/">OpenID Connect Liferay Plugin</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/apache-saml/">SAML SP in CentOS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/ubuntu-shib-apache/">SAML SP in Ubuntu</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/iis-saml/">SAML SP in IIS7</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/saml-windows/">SAML SP in Windows</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Integration Guides</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/google-saml/">Google SSO</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/office365/">Office 365 SSO</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/hobsons-saml/">Hobsons Education Solution SSO</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/salesforce-sso/">Salesforce SSO</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/dropbox/">Dropbox SSO</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/test-shib2/">TestShib2 SSO</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrate/asimba/">Asimba & Gluu CE</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Fine Tuning and Benchmarking</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fine-tuning/">Tuning LDAP, Tomcat</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Gluu Defaults</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../gluu-defaults/policy/">Gluu Policy</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../gluu-defaults/config/">Configurations</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../gluu-defaults/certificates/">Certificates</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../gluu-defaults/ldap/">LDAP</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../gluu-defaults/logout/">Logout</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../gluu-defaults/schema/">Schema</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../gluu-defaults/oxtrust-properties/">oxTrust Properties File</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../gluu-defaults/oxauth-properties/">oxAuth Properties File</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../gluu-defaults/logs/">Logs</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Gluu Server API</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/oic-authorization/">OpenID Connect Authorization Endpoint</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/oic-token/">OpenID Connect Token Endpoint</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/oic-userinfo/">OpenID Connect UserInfo Endpoint</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/oic-register-client/">OpenID Connect Client Registration Endpoint</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/oic-end-session/">OpenID Connect End Session Endpoint</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/oic-clientinfo/">OpenID Connect Client Info Endpoint</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/uma-discovery/">UMA Discovery Endpoint</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/uma-authorization-endpoint/">UMA Authorization Endpoint</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/uma-resource-registration/">UMA Resource Registration Endpoint</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/uma-permission-registration/">UMA Permission Registration Endpoint</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/uma-create-rpt/">UMA CreateRPT Endpoint</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/uma-rpt-status/">UMA RPT Introspection Endpoint</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/id-generation/">Custom ID Generation API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/scim-1.1/">SCIM 1.1</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../api/scim-2.0/">SCIM 2.0</a>
        
    </li>

        
    </ul>
<li>
		
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Gluu Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Customize Gluu Server &raquo;</li>	 
        
      
    
    <li>Custom Script How-To</li>
    <li class="wy-breadcrumbs-aside">
           
      
        
          <a href="https://github.com/GluuFederation/docs/blob/master/sources/customize/auth-script.md" class="icon icon-github"> Edit on GitHub</a>
      
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <div class="toc">
<ul>
<li><a href="#writing-a-custom-authentication-script">Writing a Custom Authentication Script</a><ul>
<li><a href="#custom-script-location">Custom Script Location</a></li>
<li><a href="#suggested-development-environment">Suggested Development Environment</a><ul>
<li><a href="#install-eclipse-plugins">Install Eclipse Plugins</a></li>
<li><a href="#create-a-project">Create a project</a></li>
</ul>
</li>
<li><a href="#samples-and-documentation">Samples and Documentation</a></li>
<li><a href="#implement-methods">Implement methods</a></li>
<li><a href="#custom-properties">Custom Properties</a></li>
<li><a href="#returning-a-message-to-the-user">Returning a message to the user</a></li>
<li><a href="#adding-libraries">Adding Libraries</a></li>
<li><a href="#testing">Testing</a></li>
</ul>
</li>
<li><a href="#reverting-authentication-method">Reverting Authentication Method</a></li>
</ul>
</div>
<h1 id="writing-a-custom-authentication-script">Writing a Custom Authentication Script</h1>
<p>To develop this article, I decided to write a script to use
<a href="http://twilio.com">Twilio</a> to send an SMS code to implement a two-step
out-of-band authentication mechanism.</p>
<h2 id="custom-script-location">Custom Script Location</h2>
<p>Gluu Server User Interface allows the developer to specify the path to
script rather than use the text box from oxTrust. The script will be
loaded from the specified path. This feature will improve script
development and there is an option to revert back to working script, if
the script is faulty or needs further development. </p>
<p>The administrator can select <code>File</code> from the Script Location Type in oxTrust and the file
input box will be displayed:
<img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/auth_article/script_upload_box.png" /></p>
<p>The 'LDAP' option in the Script Location
Type can be used to store the script in the LDAP tree once the
development is complete. Remember that selecting the <code>LDAP</code> method
requires that the script has to be copied in the input box that appears
upon LDAP selection:</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/auth_article/script_in_ldap.png" /></p>
<h2 id="suggested-development-environment">Suggested Development Environment</h2>
<p>Gluu Server custom scripts are written in
<a href="http://www.jython.org/">Jython</a>. In this article, I'm going to
recommend using Eclipse. You cannot actually run the scripts from
Eclipse, but it provides a nice editor which makes coding more
enjoyable.</p>
<p>Before you begin, install the following:</p>
<ul>
<li><a href="https://www.python.org/downloads/">Python 2.7.x</a></li>
<li><a href="http://www.jython.org/downloads.html">Jython</a></li>
<li><a href="http://www.oracle.com/technetwork/java/javase/terms/products/index.html">Java Standard Edition</a></li>
<li><a href="https://eclipse.org/downloads/">Eclipse IDE for Java Developers</a></li>
</ul>
<h3 id="install-eclipse-plugins">Install Eclipse Plugins</h3>
<p>PyDev is a useful Eclipse tool for editing Python files. It also
supports Jython. To add an Eclipse plugin, the first thing to do to
select "Install New Software" from the Help menu:</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/auth_article/01-install-software.jpg" /></p>
<p>After this, you'll need to add the repositories for the software.</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/auth_article/02-Add-Repositories.jpg" /></p>
<ul>
<li>PyDev - http://download.jboss.org/jbosstools/mars/development/updates/</li>
<li>JBoss Tools - http://download.jboss.org/jbosstools/mars/development/updates/</li>
</ul>
<p>Then, select the respective repository in the "Work with" dropdown, and
check the box for the software you want to install, as in the images
below:</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/auth_article/03-add-Pydev.jpg" /></p>
<p>From JBoss Tools select "Jboss Tools RichFaces" in "JBoss Web and Jave
EE Development":</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/auth_article/04-add-jboss-richfaces.jpg" /></p>
<h3 id="create-a-project">Create a project</h3>
<p>As the next step specify the Jython interpreter under the Window /
Preferences menu:</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/auth_article/05-preferences-jython-interpreter.jpg" /></p>
<p>Now you can create a new project to keep all your stuff. From the File
menu, create a new PyDev project:</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/auth_article/06-new-pydev-project.jpg" /></p>
<p>Now, you can create some files:</p>
<ul>
<li>A Python file for your script</li>
<li>Zero or more XHTML files if you have a custom form for your authentication</li>
<li>Zero or more XML files (you'll need one for each XHTML file) that
   provide some information to the Tomcat server about how to display
   the XHTML file.</li>
</ul>
<h2 id="samples-and-documentation">Samples and Documentation</h2>
<p>There are many good examples of authentication interception scripts
checked into the <a href="https://github.com/GluuFederation/oxAuth/tree/master/Server/integrations">integrations
folder</a>
of the oxAuth project. Also, the respective <code>XHTML</code> and <code>XML</code> files are
checked in to the <a href="https://github.com/GluuFederation/oxAuth/tree/master/Server/src/main/webapp/auth">auth
folder</a>. The interfaces for the authentication interception can be found in the <a href="http://www.gluu.org/docs/reference/interception-scripts/#authentication">Gluu
Documentation</a>.</p>
<p>When I started my Twilio script, I decided to use the <a href="https://raw.githubusercontent.com/GluuFederation/oxAuth/master/Server/integrations/basic/BasicExternalAuthenticator.py">Basic
Script</a>
as a template. I also used the <a href="https://github.com/GluuFederation/oxAuth/tree/master/Server/src/main/webapp/auth/wikid">Wikid
Forms</a> as my templates for the forms, because I remembered that I'd basically
need to get a code in step 2.
I also looked at the <a href="https://github.com/GluuFederation/oxAuth/blob/master/Server/integrations/wikid/WikidExternalAuthenticator.py">Wikid
Authentication</a>
script quite a bit for examples of how to process the form.</p>
<h2 id="implement-methods">Implement methods</h2>
<p>The most important method to implement is obviously the <code>authenticate</code>
method. This is where the main business logic is located for your
authentication workflow. Notice how you can switch on the step, with the
<code>if (step == 1):</code> statement. In oxAuth, there is no assumption that step
1 and step 2 happen on the same server, so the step is sent into the
<code>authenticate</code> method.</p>
<p>To access  information from requestParameters in your script with <code>ServerUtil.getFirstValue(requestParameters, &lt;key&gt;)</code> where <code>&lt;key&gt;</code> specifies the value you want to retrieve, you can also use another method <code>requestParameters.get("&lt;key&gt;")</code> where <code>&lt;key&gt;</code> specifies the value you want to retrieve .</p>
<p>Another method you usually need to implement is
<code>getCountAuthenticationSteps</code>. This method normally just returns 1, 2,
or 3. If you are implementing an adaptive authentication strategy, where
the number of steps depends on the context, you need to get a little
fancier. Check out the Duo script for a good example of this. In our
sample <a href="https://github.com/GluuFederation/oxAuth/blob/master/Server/integrations/duo/DuoExternalAuthenticator.py">Duo
script</a>,
the organization we wrote it for only wanted to use Duo for the IT
group. So we checked group membership, and dynamically adjusted the
number of steps.</p>
<p>If you need to save session variables between steps, use the
<code>getExtraParametersForStep</code> method. The Gluu Server persists these
variables in LDAP in able to support stateless clustered two step
authentications.</p>
<p>If you need to display a special Web page for an interactive login, (or
even a custom first page) you'll need to implement the <code>getPageForStep</code>
which specifies the page you want to return for a given step.</p>
<h2 id="custom-properties">Custom Properties</h2>
<p>Sometimes it is helpful to enable system administrators to enter
properties that might change a lot. If you don't want to ask them to
modify the script, you can use the Custom Property feature, as seen in
this screenshot:</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/auth_article/07-custom-properties.jpg" /></p>
<p>To access this information in your script with
<code>configurationAttributes.get("&lt;key&gt;").getValue2()</code> where <code>&lt;key&gt;</code>
specifies the value you want to retrieve.</p>
<h2 id="returning-a-message-to-the-user">Returning a message to the user</h2>
<p>It is possible to use the Context to return a message to the user, which
could be especially useful if an error happened, or you need some kind
of user action.</p>
<h2 id="adding-libraries">Adding Libraries</h2>
<p>If you have some pure Python libraries, you can add them to
<code>/opt/tomcat/conf/python</code>, jar files can be added to
<code>/opt/tomcat/endorsed</code>.</p>
<h2 id="testing">Testing</h2>
<p>So you think you're done with your script, it is time to test it! Print
statements are sent to <code>/opt/tomcat/logs/wrapper.log</code> If you prefix your
logs, you can use <code>tail -f | grep &lt;prefix&gt;</code> to just see your script
output while you try to login to test your script. In the Twilio test
script I wrote a special method called <code>printOut</code> to make it easier to
add this prefix.</p>
<p>Also, remember that putting all your code in a <code>try / catch</code> is a good
practice to avoid unhandled exceptions. But when you're debugging,
sometimes those exceptions may give you a hint as to what's going wrong.</p>
<h1 id="reverting-authentication-method">Reverting Authentication Method</h1>
<p>It is not unlikely that you will lock yourself out of Gluu Server while testing the authentication script, if there is any problem in it. In such a case the following method can be used to revert back the older authentication method. Please see the <a href="../../faq/troubleshooting/">FAQ</a> for details.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../attributes/" class="btn btn-neutral float-right" title="Custom Attributes"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../script/" class="btn btn-neutral" title="Behaviour Customization"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../script/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../attributes/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
